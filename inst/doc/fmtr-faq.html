<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Frequently Asked Questions</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Frequently Asked Questions</h1>



<p>Below are some frequently asked questions about the
<strong>fmtr</strong> package. Click on the links below to navigate to
the full question and answer content.</p>
<div id="top" class="section level2">
<h2>Index</h2>
<ul>
<li><a href="#fdata">How do I format a data frame?</a></li>
<li><a href="#fapply">How can I add a new, formatted column to my
dataframe?</a></li>
<li><a href="#lookup">How do I use a format as a lookup?</a></li>
<li><a href="#documentation">Where is the documentation for the
formatting codes?</a></li>
<li><a href="#formats">How do I assign formats from metadata to my data
frame?</a></li>
<li><a href="#labels">How do I assign labels from metadata to my data
frame?</a></li>
<li><a href="#descriptions">How do I assign descriptions from metadata
to my data frame?</a></li>
<li><a href="#fcat">How do I create a format catalog?</a></li>
<li><a href="#usefmt">How do I use formats from a format
catalog?</a></li>
<li><a href="#assign">How do I assign formats from a catalog to a data
frame?</a></li>
<li><a href="#excel">How do I create a format catalog from an Excel
spreadsheet?</a></li>
<li><a href="#export">How do I export my format catalog to a
spreadsheet?</a></li>
<li><a href="#asfmt">Can I create a user-defined format from
data?</a></li>
<li><a href="#input">Can I create an input format?</a></li>
<li><a href="#numeric">Can I create a numeric user-defined
format?</a></li>
<li><a href="#path">Is there a way to set up a search path for a format
catalog?</a></li>
<li><a href="#sas7bcat">Is there a way to read in a format catalog from
SASÂ®?</a></li>
<li><a href="#labelsmoved">What happened to the labels()
function?</a></li>
<li><a href="#udfedit">Can I change a User-Defined Format after it has
been created?</a></li>
</ul>
</div>
<div id="content" class="section level2">
<h2>Content</h2>
<div id="fdata" class="section level3">
<h3>How do I format a data frame?</h3>
<p><strong>Q:</strong> I have a data frame with different types of
variables: numbers, dates, character values. How can I format them
without messing up the original data?</p>
<p><strong>A:</strong> With the <strong>fmtr</strong> package you can
assign the formats to the âformatâ attribute of the dataframe, and the
apply the formats using the <code>fdata()</code> function, returning the
result to a new data frame. Here is a simple example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SUBJ =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>                  <span class="at">BDATE =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;1945-10-17&quot;</span>), </span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>                            <span class="fu">as.Date</span>(<span class="st">&quot;1967-09-04&quot;</span>),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>                            <span class="fu">as.Date</span>(<span class="st">&quot;1998-04-28&quot;</span>)),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>                  <span class="at">SEX =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>                  <span class="at">WEIGHT =</span> <span class="fu">c</span>(<span class="fl">77.1107</span>, <span class="fl">64.2848</span>, <span class="fl">85.9842</span>))</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>                  </span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># View data                  </span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>dat</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#   SUBJ      BDATE SEX  WEIGHT</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># 1    1 1945-10-17   M 77.1107</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># 2    2 1967-09-04   F 64.2848</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># 3    3 1998-04-28   M 85.9842</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="co"># Assign formats</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="fu">formats</span>(dat) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">BDATE =</span> <span class="st">&quot;%Y/%m/%d&quot;</span>,</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>                     <span class="at">SEX =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span> <span class="ot">=</span> <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;F&quot;</span> <span class="ot">=</span> <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>                     <span class="at">WEIGHT =</span> <span class="st">&quot;%1.1f kg&quot;</span>)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co"># Apply formats to new data frame</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> <span class="fu">fdata</span>(dat)</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co"># View new data frame</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>dat2</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="co">#   SUBJ      BDATE    SEX  WEIGHT</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="co"># 1    1 1945/10/17   Male 77.1 kg</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co"># 2    2 1967/09/04 Female 64.3 kg</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="co"># 3    3 1998/04/28   Male 86.0 kg</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="fapply" class="section level3">
<h3>How can I add a new, formatted column to my dataframe?</h3>
<p><strong>Q:</strong> I want to add a new column to my data frame using
a format. This column will be a categorization of an existing continuous
column. I want to add it directly to my existing data frame, not create
a new one. How can I do that?</p>
<p><strong>A:</strong> First create a categorization format:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">&lt;</span> <span class="dv">5</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>             <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">5</span>, <span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<p>Then weâll create some sample data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                  <span class="at">NUM =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>))</span></code></pre></div>
<p>Then you can apply the format to your data frame using either Base R
or <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Base R method</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>dat<span class="sc">$</span>CAT <span class="ot">&lt;-</span> <span class="fu">fapply</span>(dat<span class="sc">$</span>NUM, fmt)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># View result</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>dat</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#   ID NUM CAT</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># 1  1   2   A</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># 2  2   3   A</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># 3  3   7   B</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># tidyverse method</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">CAT =</span> <span class="fu">fapply</span>(NUM, fmt))</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>       </span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>dat</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#   ID NUM CAT</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co"># 1  1   2   A</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co"># 2  2   3   A</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co"># 3  3   7   B</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="lookup" class="section level3">
<h3>How do I use a format as a lookup?</h3>
<p><strong>Q:</strong> I have a decode lookup I want to use on a
variable in my dataframe. How can I do this with the
<strong>fmtr</strong> package?</p>
<p><strong>A:</strong> There are two common ways to apply a lookup
decode with the <strong>fmtr</strong> package. One is to create a named
vector from the decode. The other is to create a user-defined
format.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Create sample data frame</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>                  <span class="at">CODE =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="cn">NA</span>))</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># Create decode vector</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>v1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="st">&quot;Value A&quot;</span>, <span class="at">B =</span> <span class="st">&quot;Value B&quot;</span>, <span class="at">C =</span> <span class="st">&quot;Value C&quot;</span>)</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co"># Create user-defined format</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>fmt1 <span class="ot">&lt;-</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;Value A&quot;</span>),</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>              <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Value B&quot;</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>              <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;C&quot;</span>, <span class="st">&quot;Value C&quot;</span>),</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>              <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="st">&quot;Other&quot;</span>))</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>              </span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co"># Apply decode vector</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="fu">fapply</span>(dat<span class="sc">$</span>CODE, v1)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># [1] &quot;Value A&quot; &quot;Value C&quot; &quot;Value B&quot; NA </span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co"># Apply user-defined format</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a><span class="fu">fapply</span>(dat<span class="sc">$</span>CODE, fmt1)</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># [1] &quot;Value A&quot; &quot;Value C&quot; &quot;Value B&quot; &quot;Other&quot;</span></span></code></pre></div>
<p>As you can see, both the named vector and the user-defined format can
decode the data. The advantage of the user-defined format is that it
allows you to handle NA values and assign defaults in a controlled
way.</p>
<p>The named vector is easy to create. But there is no way to control
what happens to any data value that is not in the lookup. Which method
to use depends on your data and the context in which you are applying
the decode.</p>
<p>Note that you may also write a vectorized function to perform the
lookup. See âExample 4â in the documentation on <code>fapply()</code>
for a vectorized function example.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="documentation" class="section level3">
<h3>Where is the documentation for the formatting codes?</h3>
<p><strong>Q:</strong> Iâm trying to create some formats for dates and
numbers, but am not sure what codes are available. Where is the
documentation for the possible codes?</p>
<p><strong>A:</strong> Some commonly used codes are documented as part
of the <strong>fmtr</strong> documentation <a href="https://fmtr.r-sassy.org/reference/FormattingStrings.html">here</a>.
Additional documentation on the possible codes for dates is <a href="https://rdrr.io/r/base/strptime.html">here</a>, and for numbers <a href="https://rdrr.io/r/base/sprintf.html">here</a>.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="formats" class="section level3">
<h3>How do I assign formats from metadata to my data frame?</h3>
<p><strong>Q:</strong> I have metadata for my datasets that includes the
desired format for each variable. How can I apply these formats to my
data?</p>
<p><strong>A:</strong> The metadata must ultimately map the variable
name to the desired format for that variable. So we can imagine there
are at least two columns in the metadata: the variable name and the
format.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Sample metadata</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>mdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">var =</span> <span class="fu">c</span>(<span class="st">&quot;col1&quot;</span>, <span class="st">&quot;col2&quot;</span>, <span class="st">&quot;col3&quot;</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                   <span class="at">fmt =</span> <span class="fu">c</span>(<span class="st">&quot;%1.1f&quot;</span>, <span class="st">&quot;%m-%d-%Y&quot;</span>, <span class="st">&quot;%1.2f%%&quot;</span>))</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># View metadata</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>mdat</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#    var      fmt</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># 1 col1    %1.1f</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co"># 2 col2 %m-%d-%Y</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># 3 col3  %1.2f%%</span></span></code></pre></div>
<p>Then imagine another data frame that needs formatting:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col1 =</span> <span class="fu">c</span>(<span class="fl">1.235</span>, <span class="fl">3.3947</span>, <span class="fl">7.2842</span>),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                  <span class="at">col2 =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-11-01&quot;</span>),</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                           <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-02&quot;</span>),</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>                           <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-03&quot;</span>)),</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>                  <span class="at">col3 =</span> <span class="fu">c</span>(<span class="fl">23.325</span>, <span class="fl">87.2746</span>, <span class="fl">64.2184</span>))</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co"># View sample data</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>dat</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#     col1       col2    col3</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="co"># 1 1.2350 2021-11-01 23.3250</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co"># 2 3.3947 2021-11-02 87.2746</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co"># 3 7.2842 2021-11-03 64.2184</span></span></code></pre></div>
<p>Now we can put the format metadata into a list:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># Create list out of metadata vectors</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>lst <span class="ot">&lt;-</span> <span class="fu">as.list</span>(mdat<span class="sc">$</span>fmt)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">names</span>(lst) <span class="ot">&lt;-</span> mdat<span class="sc">$</span>var</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># View List</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>lst</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># $col1</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># [1] &quot;%1.1f&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co"># $col2</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co"># [1] &quot;%m-%d-%Y&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co"># $col3</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co"># [1] &quot;%1.2f%%&quot;</span></span></code></pre></div>
<p>Now we can assign the list of formats to the dataframe format
attributes using the <code>formats()</code> function:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Assign formats to data</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">formats</span>(dat) <span class="ot">&lt;-</span> lst</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># Data not formatted yet</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>dat</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#     col1       col2    col3</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co"># 1 1.2350 2021-11-01 23.3250</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co"># 2 3.3947 2021-11-02 87.2746</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co"># 3 7.2842 2021-11-03 64.2184</span></span></code></pre></div>
<p>Then apply the formats using <code>fdata()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># Apply the formats to entire data frame</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">fdata</span>(dat)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#   col1       col2   col3</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># 1  1.2 11-01-2021 23.32%</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># 2  3.4 11-02-2021 87.27%</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># 3  7.3 11-03-2021 64.22%</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="labels" class="section level3">
<h3>How do I assign labels from metadata to my data frame?</h3>
<p><strong>Q:</strong> I have metadata for my datasets that includes the
desired label for each variable. How can I apply these labels to my
data?</p>
<p><strong>A:</strong> This question is similar to the above question
concerning formats in metadata. The process for applying labels from
metadata will be nearly identical to the process for formats. You will
create a named list of labels from the metadata, then assign it to the
dataframe, and apply it with <code>fdata()</code>. The difference is
that in the case of labels, you will assign them with the
<code>labels()</code> function instead of the <code>formats()</code>
function. Like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Create sample list of labels</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>lst <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">col1 =</span> <span class="st">&quot;My First Column&quot;</span>,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>            <span class="at">col2 =</span> <span class="st">&quot;My Second Column&quot;</span>, </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>            <span class="at">col3 =</span> <span class="st">&quot;My Third Column&quot;</span>)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>            </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># Create sample data frame</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">col1 =</span> <span class="fu">c</span>(<span class="fl">1.235</span>, <span class="fl">3.3947</span>, <span class="fl">7.2842</span>),</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>                  <span class="at">col2 =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-11-01&quot;</span>),</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>                           <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-02&quot;</span>),</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>                           <span class="fu">as.Date</span>(<span class="st">&quot;2021-11-03&quot;</span>)),</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>                  <span class="at">col3 =</span> <span class="fu">c</span>(<span class="fl">23.325</span>, <span class="fl">87.2746</span>, <span class="fl">64.2184</span>))</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co"># Assign labels to data frame</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="fu">labels</span>(dat) <span class="ot">&lt;-</span> lst</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co"># View label attributes</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="fu">labels</span>(dat)</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co"># $col1</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co"># [1] &quot;My First Column&quot;</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co"># $col2</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co"># [1] &quot;My Second Column&quot;</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co"># $col3</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co"># [1] &quot;My Third Column&quot;</span></span></code></pre></div>
<p>Note that starting in <strong>fmtr</strong> 1.5.8, the
<code>labels()</code> function has been moved to the
<strong>common</strong> package. To use the <code>labels()</code>
function, please reference that package.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="descriptions" class="section level3">
<h3>How do I assign descriptions from metadata to my data frame?</h3>
<p><strong>Q:</strong> I have metadata for my datasets that includes the
desired descriptions for each variable. How can I apply these
descriptions to my data?</p>
<p><strong>A:</strong> This question is similar to the questions on
applying formats from metadata, and applying labels from metadata. The
only difference is that you will use the <code>descriptions()</code>
function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># Assign descriptions</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">descriptions</span>(dat) <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">col1 =</span> <span class="st">&quot;Here is my description for col1.&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>                          <span class="at">col2 =</span> <span class="st">&quot;Here is my description for col2.&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>                          <span class="at">col3 =</span> <span class="st">&quot;Here is my description for col3.&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co"># View descriptions</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="fu">descriptions</span>(dat)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># $col1</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co"># [1] &quot;Here is my description for col1.&quot;</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co"># $col2</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># [1] &quot;Here is my description for col2.&quot;</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co"># $col3</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co"># [1] &quot;Here is my description for col3.&quot;</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="fcat" class="section level3">
<h3>How do I create a format catalog?</h3>
<p><strong>Q:</strong> I want to create a format catalog, save that
catalog, and reuse it later. How can I do that?</p>
<p><strong>A:</strong> The <strong>fmtr</strong> package provides all
the functions necessary to do what you want. Here is an example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># Create format catalog</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">fcat</span>(<span class="at">AGECAT =</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">24</span>, <span class="st">&quot;18 to 24&quot;</span>),</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">44</span>, <span class="st">&quot;25 to 44&quot;</span>),</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">64</span>, <span class="st">&quot;45 to 64&quot;</span>),</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">65</span>, <span class="st">&quot;&gt;= 65&quot;</span>),</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>                            <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="st">&quot;Other&quot;</span>)),</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>             <span class="at">SEX =</span> <span class="fu">value</span>(<span class="fu">condition</span>(<span class="fu">is.na</span>(x), <span class="st">&quot;Missing&quot;</span>),</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>                         <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;M&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>                         <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;F&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>                         <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="st">&quot;Other&quot;</span>)),</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>             <span class="at">VAR =</span> <span class="fu">c</span>(<span class="st">&quot;AGE&quot;</span> <span class="ot">=</span> <span class="st">&quot;Age&quot;</span>, </span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>                     <span class="st">&quot;AGECAT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Age Group&quot;</span>, </span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>                     <span class="st">&quot;SEX&quot;</span> <span class="ot">=</span> <span class="st">&quot;Sex&quot;</span>)) </span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co"># Save format catalog</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="fu">write.fcat</span>(fmts, <span class="st">&quot;c:/mypath&quot;</span>)</span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co"># Read format catalog back in</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">read.fcat</span>(<span class="st">&quot;c:/mypath/fmts.fcat&quot;</span>)</span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co"># View format catalog</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a>fmts</span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 elements</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co"># Use restored formats</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="fu">fapply</span>(<span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">27</span>, <span class="dv">19</span>), fmts<span class="sc">$</span>AGECAT)</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co"># [1] &quot;45 to 64&quot; &quot;25 to 44&quot; &quot;18 to 24&quot;</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="usefmt" class="section level3">
<h3>How do I use formats from a format catalog?</h3>
<p><strong>Q:</strong> My colleague gave me a format catalog. How can I
use it?</p>
<p><strong>A:</strong> First read the format catalog into R using
<code>read.fcat()</code>. Then you can begin using the formats in the
catalog using dollar sign ($) notation. Here is an example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Read format catalog back in</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">read.fcat</span>(<span class="st">&quot;c:/mypath/fmts.fcat&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># View format catalog</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>fmts</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 elements</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co"># Use restored formats</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">fapply</span>(<span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">27</span>, <span class="dv">19</span>), fmts<span class="sc">$</span>AGECAT)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># [1] &quot;45 to 64&quot; &quot;25 to 44&quot; &quot;18 to 24&quot;</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="assign" class="section level3">
<h3>How do I assign formats from a catalog to a data frame?</h3>
<p><strong>Q:</strong> I have a format catalog that I use to store
formats. The formats are shared between several datasets. How can I
assign formats from the catalog to one of my datasets?</p>
<p><strong>A:</strong> Read the format catalog in using
<code>read.fcat()</code>, then assign the formats using the
<code>formats()</code> function. Like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Read format catalog in</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">read.fcat</span>(<span class="st">&quot;c:/mypath/fmts.fcat&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># View format catalog</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>fmts</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 elements</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co"># Create sample data frame</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&#39;</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="st">SUBJECT  AGECAT SEX</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="st">101       35      F</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="st">102       19      F</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="st">103       57      M</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="st">&#39;</span>)</span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co"># Assign formats from catalog to data frame</span></span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a><span class="fu">formats</span>(dat) <span class="ot">&lt;-</span> fmts</span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a><span class="co"># View formatted data</span></span>
<span id="cb15-23"><a href="#cb15-23" tabindex="-1"></a><span class="fu">fdata</span>(dat)</span>
<span id="cb15-24"><a href="#cb15-24" tabindex="-1"></a><span class="co">#   SUBJECT   AGECAT    SEX</span></span>
<span id="cb15-25"><a href="#cb15-25" tabindex="-1"></a><span class="co"># 1     101 25 to 44 Female</span></span>
<span id="cb15-26"><a href="#cb15-26" tabindex="-1"></a><span class="co"># 2     102 18 to 24 Female</span></span>
<span id="cb15-27"><a href="#cb15-27" tabindex="-1"></a><span class="co"># 3     103 45 to 64   Male</span></span></code></pre></div>
<p>Note that this only works when the format names in the catalog
correspond to the column names in the dataframe. If the names in the
catalog do not correspond to the column names, it is best to manipulate
the names of the format catalog using the <code>names()</code> function
so that they match the column names in the dataframe. Then proceed as
above. Like this:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Read format catalog in</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">read.fcat</span>(<span class="st">&quot;c:/packages/fmts.fcat&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co"># View format catalog</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>fmts</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 elements</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co"># Create sample data frame</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&#39;</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="st">SUBJ     AGE GENDER</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="st">101       35      F</span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="st">102       19      F</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="st">103       57      M</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="st">&#39;</span>)</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="co"># Reassign format names in catalog</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="fu">names</span>(fmts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;GENDER&quot;</span>, <span class="st">&quot;VAR&quot;</span>)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="co"># Assign formats from catalog to data frame</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="fu">formats</span>(dat) <span class="ot">&lt;-</span> fmts</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="co"># View formatted data</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="fu">fdata</span>(dat)</span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="co">#   SUBJECT   AGECAT    SEX</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="co"># 1     101 25 to 44 Female</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="co"># 2     102 18 to 24 Female</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="co"># 3     103 45 to 64   Male</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="excel" class="section level3">
<h3>How do I create a format catalog from an Excel spreadsheet?</h3>
<p><strong>Q:</strong> I have format information stored in an Excel
spreadsheet. Can I use that to create a format catalog and format my
data?</p>
<p><strong>A:</strong> Yes, provided the data is either in the correct
structure or can be put in the correct structure to create a format
catalog. The correct structure includes the following columns: Name,
Type, Expression, Label and Order. See the documentation on
<code>as.fcat.data.frame()</code> for further description of the needed
column values.</p>
<p>Here is an example showing Excel data that is already in the correct
structure:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co"># Read data from Excel</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>xldat <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;c:</span><span class="sc">\\</span><span class="st">packages</span><span class="sc">\\</span><span class="st">myxlfile.xlsx&quot;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># View data frame</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>xldat</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co"># # A tibble: 10 x 5</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co"># Name   Type  Expression                                                Label    Order</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co"># &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;                                                     &lt;chr&gt;    &lt;lgl&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co"># 1  AGECAT U     &quot;x &gt;= 18 &amp; x &lt;= 24&quot;                                       18 to 24 NA   </span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co"># 2  AGECAT U     &quot;x &gt;= 25 &amp; x &lt;= 44&quot;                                       25 to 44 NA   </span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="co"># 3  AGECAT U     &quot;x &gt;= 45 &amp; x &lt;= 64&quot;                                       45 to 64 NA   </span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co"># 4  AGECAT U     &quot;x &gt;= 65&quot;                                                 &gt;= 65    NA   </span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co"># 5  AGECAT U     &quot;TRUE&quot;                                                    Other    NA   </span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co"># 6  SEX    U     &quot;is.na(x)&quot;                                                Missing  NA   </span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co"># 7  SEX    U     &quot;x == \&quot;M\&quot;&quot;                                              Male     NA   </span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co"># 8  SEX    U     &quot;x == \&quot;F\&quot;&quot;                                              Female   NA   </span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co"># 9  SEX    U     &quot;TRUE&quot;                                                    Other    NA   </span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="co"># 10 VAR    V     &quot;c(AGE = \&quot;Age\&quot;, AGECAT = \&quot;Age Group\&quot;, SEX = \&quot;Sex\&quot;)&quot; NA       NA </span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="co"># Convert dataframe to format catalog</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">as.fcat</span>(xldat)</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="co"># View format catalog                     </span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>fmts</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 element</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="co"># Create sample data frame</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&#39;</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a><span class="st">SUBJECT AGECAT  SEX</span></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a><span class="st">101       35      F</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="st">102       19      F</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="st">103       57      M</span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="st">&#39;</span>)</span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="co"># Assign formats from catalog</span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a><span class="fu">formats</span>(dat) <span class="ot">&lt;-</span> fmts</span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co"># Apply formats</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a><span class="fu">fdata</span>(dat)</span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="co">#   SUBJECT   AGECAT    SEX</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="co"># 1     101 25 to 44 Female</span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="co"># 2     102 18 to 24 Female</span></span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a><span class="co"># 3     103 45 to 64   Male</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="export" class="section level3">
<h3>How do I export my format catalog to a spreadsheet?</h3>
<p><strong>Q:</strong> I have a format catalog I created in R with the
<strong>fmtr</strong> package. I want to store that catalog in a
spreadsheet for documentation purposes. How can I do that?</p>
<p><strong>A:</strong> There is a Base R function
<code>as.data.frame()</code> that can be used to convert a
<strong>fmtr</strong> user-defined format or a format catalog to a data
frame. From there, it is easy to export to Excel or any other file
format you like. Here is an example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co"># Create sample format catlog</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>fmts <span class="ot">&lt;-</span> <span class="fu">fcat</span>(<span class="at">AGECAT =</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">18</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">24</span>, <span class="st">&quot;18 to 24&quot;</span>),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">25</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">44</span>, <span class="st">&quot;25 to 44&quot;</span>),</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">45</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">64</span>, <span class="st">&quot;45 to 64&quot;</span>),</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>                            <span class="fu">condition</span>(x <span class="sc">&gt;=</span> <span class="dv">65</span>, <span class="st">&quot;&gt;= 65&quot;</span>),</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>                            <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="st">&quot;Other&quot;</span>)),</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>             <span class="at">SEX =</span> <span class="fu">value</span>(<span class="fu">condition</span>(<span class="fu">is.na</span>(x), <span class="st">&quot;Missing&quot;</span>),</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>                         <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;M&quot;</span>, <span class="st">&quot;Male&quot;</span>),</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>                         <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;F&quot;</span>, <span class="st">&quot;Female&quot;</span>),</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>                         <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="st">&quot;Other&quot;</span>)),</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>             <span class="at">VAR =</span> <span class="fu">c</span>(<span class="st">&quot;AGE&quot;</span> <span class="ot">=</span> <span class="st">&quot;Age&quot;</span>, </span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>                     <span class="st">&quot;AGECAT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Age Group&quot;</span>, </span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>                     <span class="st">&quot;SEX&quot;</span> <span class="ot">=</span> <span class="st">&quot;Sex&quot;</span>)) </span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>                     </span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co"># View format catalog                     </span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>fmts</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co"># # A format catalog: 3 formats</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co"># - $AGECAT: type U, 5 conditions</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co"># - $SEX: type U, 4 conditions</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a><span class="co"># - $VAR: type V, 3 element</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a><span class="co"># Convert format catalog to data frame</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fmts)</span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a><span class="co"># Write data frame to Excel using openxlsx</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a><span class="fu">write.xlsx</span>(dat, <span class="st">&quot;c:</span><span class="sc">\\</span><span class="st">mypath</span><span class="sc">\\</span><span class="st">myxlfile.xlsx&quot;</span>)</span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="asfmt" class="section level3">
<h3>Can I create a user-defined format from data?</h3>
<p><strong>Q:</strong> I have a dataset with a code list that I want to
create a user-defined format from. Is there a way to do that?</p>
<p><strong>A:</strong> Yes. There is a function <code>as.fmt()</code>
that allows you to convert a data frame into a user-defined format. But
the input dataframe needs a specific structure. Here is an example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co"># Create sample input data </span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span><span class="st">&#39;</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="st">        Col1  Col2 </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="st">        A    &quot;Label A&quot;</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="st">        B    &quot;Label B&quot;</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="st">        C    &quot;Label C&quot;&#39;</span>)</span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co"># Create main conditions</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="st">&quot;myfmt&quot;</span>, </span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>                  <span class="at">Type =</span> <span class="st">&quot;U&quot;</span>, </span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>                  <span class="at">Expression =</span> <span class="fu">paste0</span>(<span class="st">&quot;x == &#39;&quot;</span>, dat<span class="sc">$</span>Col1, <span class="st">&quot;&#39;&quot;</span>),</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>                  <span class="at">Label =</span> dat<span class="sc">$</span>Col2,</span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>                  <span class="at">Order =</span> <span class="cn">NA</span>)</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co"># Create default condition</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="st">&quot;myfmt&quot;</span>, </span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>                  <span class="at">Type =</span> <span class="st">&quot;U&quot;</span>, </span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>                  <span class="at">Expression =</span> <span class="st">&quot;TRUE&quot;</span>,</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>                  <span class="at">Label =</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>                  <span class="at">Order =</span> <span class="cn">NA</span>)</span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co"># Append default condition</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df1, df2)</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a><span class="co"># View input data</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>df</span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co">#    Name Type Expression   Label Order</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a><span class="co"># 1 myfmt    U   x == &#39;A&#39; Label A    NA</span></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a><span class="co"># 2 myfmt    U   x == &#39;B&#39; Label B    NA</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co"># 3 myfmt    U   x == &#39;C&#39; Label C    NA</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a><span class="co"># 4 myfmt    U       TRUE   Other    NA</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a><span class="co"># Convert data frame to user-defined format </span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="fu">as.fmt</span>(df)</span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a><span class="co"># Apply the format</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a><span class="fu">fapply</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="cn">NA</span>), fmt)</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a><span class="co"># [1] &quot;Label A&quot; &quot;Label B&quot; &quot;Label C&quot; &quot;Other&quot; </span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="input" class="section level3">
<h3>Can I create an input format?</h3>
<p><strong>Q:</strong> SASÂ® distinguishes between an input format and an
output format. Is there a similar distinction in the
<strong>fmtr</strong> package?</p>
<p><strong>A:</strong> No.Â All <strong>fmtr</strong> formats are output
formats.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="numeric" class="section level3">
<h3>Can I create a numeric user-defined format?</h3>
<p><strong>Q:</strong> I have a column of data with some character
values that I want to convert to a number. Iâd like to create a format
to do that. Can I create a user-defined format that returns a number
instead of a text string?</p>
<p><strong>A:</strong> Yes. The second parameter of the
<code>condition()</code> function accepts a character, numeric, or
logical value. That means a <strong>fmtr</strong> user-defined format
can be used to translate incoming values, whether character or numeric,
to a number. Here is an example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>nfmt <span class="ot">&lt;-</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>              <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="dv">2</span>),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>              <span class="fu">condition</span>(<span class="cn">TRUE</span>, <span class="dv">3</span>))</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="fu">fapply</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>), nfmt)</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co"># [1] 1 2 3</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="path" class="section level3">
<h3>Is there a way to set up a search path for a format catalog?</h3>
<p><strong>Q:</strong> In SASÂ® you can set up a search path for a format
catalog, so you donât need to read it. You can just reference the format
names and it will work. Is there a similar functionality in the
<strong>fmtr</strong> package?</p>
<p><strong>A:</strong> Not exactly. What you can do is use the
<code>file.find()</code> function from the <em>common</em> package to
search for the format catalog file, and then read the catalog into your
program using <code>read.fcat()</code>. From there you just use the
format catalog as normal.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="sas7bcat" class="section level3">
<h3>Is there a way to read in a format catalog from SASÂ®?</h3>
<p><strong>Q:</strong> I have an existing format catalog from SASÂ® that
I want to convert to R. Does the <strong>fmtr</strong> package provide a
way to read in a SASÂ® format catalog?</p>
<p><strong>A:</strong> Not directly. What you can do is export the SAS
format catalog to a dataset, read the dataset into R, and rearrange the
data to correspond to the requirements of
<code>as.fcat.data.frame()</code>. Then use
<code>as.fcat.data.frame()</code> to convert the data frame to a
<em>fmtr</em> format catalog. Note that SASÂ® provides a lot of
functionality in their formats that cannot be reproduced in
<strong>fmtr</strong>. So there is no guarantee that all your SAS
formats will convert as desired.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="labelsmoved" class="section level3">
<h3>What happened to the labels() function?</h3>
<p><strong>Q:</strong> I had been using the <code>labels()</code>
function in a few programs, and now they are all broken. It appears the
<code>labels()</code> function is no longer part of the
<strong>fmtr</strong> package. What happened?</p>
<p><strong>A:</strong> The <code>labels()</code> function has been moved
to the <strong>common</strong> package. The reason it was moved is
because this function is so generally useful, that the
<strong>common</strong> package was deemed a more appropriate home. You
can fix your code by simply adding a reference to the
<strong>common</strong> package.</p>
<p><a href="#top">top</a></p>
<hr />
</div>
<div id="udfedit" class="section level3">
<h3>Can I change a User-Defined Format after it has been created?</h3>
<p><strong>Q:</strong> I created a User_Define Format, and now I want to
add a new item to it. Is there a way to do that?</p>
<p><strong>A:</strong> Yes. Reminder that, in the end, a User-Defined
Format is a list, and can be manipulated as such. You can change a
User-Defined Format the same way you change a list. For example:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">library</span>(fmtr)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co"># Create format</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="fu">value</span>(<span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;Group A&quot;</span>),</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>             <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="st">&quot;Group B&quot;</span>))</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>)</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co"># Apply format</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="fu">fapply</span>(dat, fmt)</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co"># [1] &quot;Group A&quot; &quot;Group B&quot; &quot;C&quot;</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co"># Add &quot;C&quot; condition to format</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>fmt[[<span class="fu">length</span>(fmt) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">condition</span>(x <span class="sc">==</span> <span class="st">&quot;C&quot;</span>, <span class="st">&quot;Group C&quot;</span>)</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co"># Apply revised format</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="fu">fapply</span>(dat, fmt)</span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co"># [1] &quot;Group A&quot; &quot;Group B&quot; &quot;Group C&quot;</span></span></code></pre></div>
<p><a href="#top">top</a></p>
<hr />
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
