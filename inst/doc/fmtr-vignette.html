<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>fmtr-vignette</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>





<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">fmtr-vignette</h1>



<div id="fmtr" class="section level1">
<h1>fmtr <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjxzdmcgZGF0YS1uYW1lPSJMYXllciAxIiBpZD0iTGF5ZXJfMSIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHRpdGxlLz48cGF0aCBkPSJNMTI2LDQ5Ljc3aC01Ljc4bDEuMDctMi4wNWExLjkzLDEuOTMsMCwwLDAtLjA4LTEuOTIsMiwyLDAsMCwwLTEuNzEtLjk0SDQxLjczYTkuMTcsOS4xNywwLDAsMC0zLjY0LTQuNzQsMTAuMTMsMTAuMTMsMCwwLDAtOC42OC0xLjc3LDIsMiwwLDAsMC0xLC43MmwtMjYsMzYsLjA5LjA2YTguNyw4LjcsMCwwLDAtMi40Niw2QTguOTEsOC45MSwwLDAsMCw4LjIyLDkwYTIsMiwwLDAsMCwuMjgsMGguNTVsODAtLjM4YTEuODMsMS44MywwLDAsMCwuOSwwbDguMzIsMGEyLDIsMCwwLDAsMS43Ny0xLjA3bDEtMS45NGg3LjY3YTIsMiwwLDEsMCwwLTMuOTJoLTUuNjNsMi4yNC00LjMxSDExM2EyLDIsMCwxLDAsMC0zLjkyaC01LjU1bDIuMjQtNC4zMWg3LjUxYTIsMiwwLDEsMCwwLTMuOTJoLTUuNDdsMi40MS00LjYzaDguNGEyLDIsMCwxLDAsMC0zLjkyaC02LjM2bDItMy45MkgxMjZhMiwyLDAsMSwwLDAtMy45MlpNOSw4Ni4wOGE0LjkxLDQuOTEsMCwxLDEsNS00LjkxQTUsNSwwLDAsMSw5LDg2LjA4Wm0yMy44OC03LjcyLS44MSwyLjIzLTEuODktMS4yNi0zLjEuOEwyOC44NCw3OGwtMS4xMS0xLjczLDMtLjA2LDIuNDItMS44Ny4wNywyLjEsMi42LjU4Wm0tMTUuNTctLjU3YTksOSwwLDAsMC04LjA3LTUuNDNMMzEuMjMsNDJhNi43Nyw2Ljc3LDAsMCwxLDQuNTEsMS4zNiw1LjExLDUuMTEsMCwwLDEsMi4yLDIuODhaTTQ2LDU5LjQxbC0xLjg5LTEuMjYtMy4xLjgsMS43Ny0yLjE0LTEuMTEtMS43MywzLS4wNkw0Nyw1My4xNGwuMDcsMi4xLDIuNi41OC0yLjkzLDEuMzZabTI0LDE5YTIsMiwwLDAsMS0xLjI2LDEuMjFBMiwyLDAsMCwxLDY3LDc5LjM4bC02LjIxLTQuMTZMNTAuMiw3OEEyLDIsMCwwLDEsNDgsNzcuMTNhMS45MywxLjkzLDAsMCwxLC4xMy0yLjNMNTMuNzYsNjhsLTMuMzMtNS4yMmExLjkzLDEuOTMsMCwwLDEtLjA2LTIsMiwyLDAsMCwxLDEuNzItMWwxMC4zMy0uMjEsOC40MS02LjUxYTIsMiwwLDAsMSwyLjA4LS4yNCwyLDIsMCwwLDEsMS4xNiwxLjcxbC4yMiw2LjI1LDguMSwxLjhhMiwyLDAsMCwxLDEuNTUsMS43LDIsMiwwLDAsMS0xLjEzLDJMNzIuNzMsNzFabTE0LjYsMS4xMy0uODEsMi4yMy0xLjg5LTEuMjYtMy4xLjgsMS43Ny0yLjE0LTEuMTEtMS43MywzLS4wNiwyLjQyLTEuODcuMDcsMi4xLDIuNi41OFptNi41Ny0yNC4yMywzLS4wNiwyLjQyLTEuODcuMDcsMi4xLDIuNi41OC0yLjkzLDEuMzYtLjgxLDIuMjNMOTMuNjIsNTguNGwtMy4xLjgsMS43Ny0yLjE0Wm01LjkxLDMwLjMzLTQuMjEsMCwxOS4yMi0zNi44OWg0LjE1WiIvPjxwYXRoIGQ9Ik03MC4zNCw2Mi40NWwtLjE0LTMuODktNS44NCw0LjUyYTIsMiwwLDAsMS0xLjIuNDJsLTcuNDguMTUsMi4yMSwzLjQ3YTEuOTMsMS45MywwLDAsMS0uMTQsMi4yOGwtMi42OCwzLjI1LDUuNTYtMS40M2EyLDIsMCwwLDEsMS42NC4yOGw0LjgzLDMuMjMsMi4xMy01Ljg0YTIsMiwwLDAsMSwxLTEuMTFsNS41OC0yLjU5LTMuOTUtLjg3QTIsMiwwLDAsMSw3MC4zNCw2Mi40NVoiLz48L3N2Zz4=" align="right" height="138" /></h1>
<p>The <strong>fmtr</strong> package helps format data. The package aims to simulate the basic functionality of SASÂ® formats, but with R.</p>
<p>Formatting may be assigned to data frame columns using the <strong>format</strong>, <strong>width</strong>, and <strong>justify</strong> attributes. Formatting is then applied by calling the <code>fdata</code> function. <code>fdata</code> returns a new data frame with the specified formatting applied. This method of formatting provides much greater control over data formatting than the base R <code>format</code> function.</p>
<p>Here is a example:</p>
<pre><code># Construct data frame from state vectors
df &lt;- data.frame(state = state.abb, area = state.area)[1:10, ]

# Calculate percentages
df$pct &lt;- df$area / sum(state.area) * 100

# Before formatting 
df

#    state   area         pct
# 1     AL  51609  1.42629378
# 2     AK 589757 16.29883824
# 3     AZ 113909  3.14804973
# 4     AR  53104  1.46761040
# 5     CA 158693  4.38572418
# 6     CO 104247  2.88102556
# 7     CT   5009  0.13843139
# 8     DE   2057  0.05684835
# 9     FL  58560  1.61839532
# 10    GA  58876  1.62712846

# Create state name lookup list
name_lookup &lt;- state.name
names(name_lookup) &lt;- state.abb

# Assign formats
formats(df) &lt;- list(state = name_lookup,                         
                    area  = function(x) format(x, big.mark = &quot;,&quot;), 
                    pct   = &quot;%.1f%%&quot;) 

# Apply formats
fdata(df)

#          state    area   pct
# 1      Alabama  51,609  1.4%
# 2       Alaska 589,757 16.3%
# 3      Arizona 113,909  3.1%
# 4     Arkansas  53,104  1.5%
# 5   California 158,693  4.4%
# 6     Colorado 104,247  2.9%
# 7  Connecticut   5,009  0.1%
# 8     Delaware   2,057  0.1%
# 9      Florida  58,560  1.6%
# 10     Georgia  58,876  1.6%
</code></pre>
<div id="key-features" class="section level2">
<h2>Key Features</h2>
<p><strong>fmtr</strong> contains the following key features:</p>
<ul>
<li>The <code>fdata</code> function to apply formatting to any data frame or tibble.</li>
<li>The <code>fapply</code> function to apply formatting to any vector.</li>
<li>The <code>formats</code> and <code>fattr</code> functions to easily assign formatting attributes.</li>
<li>The <code>value</code> and <code>condition</code> functions to create a new user-defined format.</li>
<li>The <code>flist</code> function to create a formatting list.</li>
</ul>
</div>
<div id="how-to-use-fdata" class="section level2">
<h2>How to use fdata()</h2>
<p>Data can be formatted by assigning formats to the <strong>format</strong> attribute of the columns in your dataframe or tibble, and then by calling the <code>fdata()</code> function on that data. A sample program is as follows:</p>
<pre><code># Set up data frame
df &lt;- mtcars[1:10, c(&quot;mpg&quot;, &quot;cyl&quot;)]
df

# Define and assign formats
attr(df$mpg, &quot;format&quot;) &lt;- value(condition(x &gt;= 20, &quot;High&quot;),
                                condition(x &lt; 20, &quot;Low&quot;))

attr(df$cyl, &quot;format&quot;) &lt;- function(x) format(x, nsmall = 1)

# Apply formatting
fdata(df)
</code></pre>
<p>Here is the mtcars subset before formatting:</p>
<pre><code>#                    mpg cyl
# Mazda RX4         21.0   6
# Mazda RX4 Wag     21.0   6
# Datsun 710        22.8   4
# Hornet 4 Drive    21.4   6
# Hornet Sportabout 18.7   8
# Valiant           18.1   6
# Duster 360        14.3   8
# Merc 240D         24.4   4
# Merc 230          22.8   4
# Merc 280          19.2   6</code></pre>
<p>And here is the mtcars subset after formatting:</p>
<pre><code>#                    mpg cyl
# Mazda RX4         High 6.0
# Mazda RX4 Wag     High 6.0
# Datsun 710        High 4.0
# Hornet 4 Drive    High 6.0
# Hornet Sportabout Low  8.0
# Valiant           Low  6.0
# Duster 360        Low  8.0
# Merc 240D         High 4.0
# Merc 230          High 4.0
# Merc 280          Low  6.0
</code></pre>
<p>You may apply formatting to variables of any data type: character, numeric, date, etc. Internally, the <code>fdata()</code> function is using the <code>fapply()</code> function on each column in the data frame. If there is no format assigned to a column, that column is returned unaltered.</p>
</div>
<div id="how-to-use-fapply" class="section level2">
<h2>How to use fapply()</h2>
<p>The <code>fapply()</code> function applies a format to a vector, factor, or list. This function may be used independently of the <code>fdata()</code> function. Here is an example:</p>
<pre><code>v1 &lt;- c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;B&quot;)
v1

# [1] &quot;A&quot; &quot;B&quot; &quot;C&quot; &quot;B&quot;

fmt1 &lt;- value(condition(x == &quot;A&quot;, &quot;Label A&quot;),
              condition(x == &quot;B&quot;, &quot;Label B&quot;),
              condition(TRUE, &quot;Other&quot;))

fapply(v1, fmt1)

# &quot;Label A&quot; &quot;Label B&quot;   &quot;Other&quot; &quot;Label B&quot; 
</code></pre>
<p>One advantage of using <code>fapply()</code> is that your original data is not altered. The formatted values are assigned to a new object. If your original data changes, the formatting function should be reapplied to maintain consistency with the original data.</p>
</div>
<div id="what-kind-of-formats-are-available" class="section level2">
<h2>What kind of formats are available</h2>
<p>Data can be formatted with several different types of objects: * A formatting string * A named vector * A user-defined format * A vectorized function * A formatting list</p>
<p>You can use the type of formatting object that is most suitable to your data and situation. Each type of formatting object has itâs own strengths and weaknesses.</p>
<div id="formatting-string" class="section level4">
<h4>Formatting String</h4>
<p>The formatting functions accept formatting strings such as those associated with the Base R <code>format</code> and <code>sprintf</code> functions. If the data type of the vector is a date or datetime, <code>fapply</code> will use the format codes associated with the <code>format</code> function. For other data types, <code>fapply</code> will use the format codes associated with <code>sprintf</code>. Here is an example:</p>
<pre><code>v1 &lt;- c(1.367, 8.356, 4.583, 2.873)

fapply(v1, &quot;%.1f%%&quot;)

[1] &quot;1.4%&quot; &quot;8.4%&quot; &quot;4.6%&quot; &quot;2.9%&quot;
</code></pre>
</div>
<div id="named-vectors" class="section level4">
<h4>Named vectors</h4>
<p>Data may be formatted using a named vector as a lookup. Simply ensure that the names on the formatting vector correspond to the values in the data vector.<br />
The advantage of using a named vector for formatting is its simplicity. The disadvantage is that it only works with character values. Here is an example of formatting using a named vector:</p>
<pre><code>v1 &lt;- c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;B&quot;)

fmt1 &lt;- c(A = &quot;Label A&quot;, B = &quot;Label B&quot;, C= &quot;Label C&quot;)

fapply(v1, fmt1)

# &quot;Label A&quot; &quot;Label B&quot; &quot;Label C&quot; &quot;Label B&quot; 
</code></pre>
</div>
<div id="user-defined-formats" class="section level4">
<h4>User-defined formats</h4>
<p>The <strong>fmtr</strong> package provides custom functions for creating user-defined formats, in a manner that is similar to a SASÂ® user-defined format. These functions are <code>value</code> and <code>condition</code>. The <code>value</code> function accepts one or more conditions. The <code>conditions</code> function accepts an expression/label pair. A user-defined format has the advantage of a clear and flexible syntax. It is excellent for categorizing data. Here is an example of a user-defined format:</p>
<pre><code>v1 &lt;- c(&quot;A&quot;, &quot;B&quot;, NA, &quot;C&quot;)

fmt2 &lt;- value(condition(is.na(x), &quot;Missing&quot;),
              condition(x == &quot;A&quot;, &quot;Label A&quot;),
              condition(x == &quot;B&quot;, &quot;Label B&quot;),
              condition(TRUE, &quot;Other&quot;))
              
fapply(v1, fmt2)

# &quot;Label A&quot; &quot;Label B&quot;   &quot;Missing&quot; &quot;Other&quot; 
</code></pre>
</div>
<div id="vectorized-functions" class="section level4">
<h4>Vectorized functions</h4>
<p>Vectorized functions provide the most powerful way of formatting data. Vectorized functions can be user-defined, or wrapping an available packaged function. The vectorized function has the advantage of being nearly limitless in the types of formatting you can perform. The drawback is that a vectorized function can be more complicated to write. Here is an example of formatting with a user-defined, vectorized function:</p>
<pre><code>v1 &lt;- c(&quot;A&quot;, &quot;B&quot;, NA, &quot;C&quot;)

fmt2 &lt;- Vectorize(function(x) {
    
    if (is.na(x)) 
      ret &lt;- &quot;Missing&quot;
    else if (x %in% c(&quot;A&quot;, &quot;B&quot;))
      ret &lt;- paste(&quot;Label&quot;, x)
    else 
      ret &lt;- &quot;Other&quot;
    
    return(ret)
    
  })
  
fapply(v1, fmt2)

# &quot;Label A&quot; &quot;Label B&quot;   &quot;Missing&quot; &quot;Other&quot; 
</code></pre>
</div>
<div id="a-formatting-list" class="section level4">
<h4>A formatting list</h4>
<p>Sometimes data needs to be formatted differently for each row. This situation is difficult to deal with in any language.<br />
But it can be made easy in R with the <strong>fmtr</strong> package and a formatting list.</p>
<p>A formatting list is a list that contains one or more of the four types of formatting objects described above. A formatting list can be applied in two different ways: in order, or with a lookup.</p>
<p>By default, the list is applied in order. That means the first format in the list is applied to the first item in the vector, the second format in the list is applied to the second item in the vector, and so on. The list is recycled if the number of list items is shorter than the number of values in the vector.</p>
<p>For the lookup method, the formatting object is specified by a lookup vector. The lookup vector should contain names associated with the elements in the formatting list. The lookup vector should also contain the same number of items as the data vector. For each item in the data vector, <strong>fmtr</strong> will look up the appropriate format from the formatting list, and apply that format to the corresponding data value.</p>
<p>The following is an example of a lookup style formatting list:</p>
<pre><code># Set up data
v1 &lt;- c(&quot;num&quot;, &quot;char&quot;, &quot;date&quot;, &quot;char&quot;, &quot;date&quot;, &quot;num&quot;)
v2 &lt;- list(1.258, &quot;H&quot;, as.Date(&quot;2020-06-19&quot;),
           &quot;L&quot;, as.Date(&quot;2020-04-24&quot;), 2.8865)

df &lt;- data.frame(type = v1, values = I(v2))
df

#    type     values
# 1   num      1.258
# 2  char          H
# 3  date 2020-06-19
# 4  char          L
# 5  date 2020-04-24
# 6   num     2.8865

# Set up formatting list
lst &lt;- flist(type = &quot;row&quot;, lookup = v1,
             num = &quot;%.1f&quot;,
             char = value(condition(x == &quot;H&quot;, &quot;High&quot;),
                          condition(x == &quot;L&quot;, &quot;Low&quot;),
                          condition(TRUE, &quot;NA&quot;)),
             date = &quot;%y-%m&quot;)

# Assign formatting list to values column
attr(df$values, &quot;format&quot;) &lt;- lst


# Apply formatting
fdata(df)

#   type values
# 1  num    1.3
# 2 char   High
# 3 date  20-06
# 4 char    Low
# 5 date  20-04
# 6  num    2.9

</code></pre>
</div>
</div>
<div id="convenience-functions" class="section level2">
<h2>Convenience Functions</h2>
<div id="the-formats-function" class="section level3">
<h3>The <code>formats()</code> function</h3>
<p>The formats associated with a data frame can be easily extracted or assigned with the <code>formats()</code> function. This function returns or accepts a named list of formatting objects. The names of the list items<br />
correspond to the names of the columns in the data frame. This function is useful when you want to assign formats to many columns.</p>
</div>
<div id="the-fattr-function" class="section level3">
<h3>The <code>fattr()</code> function</h3>
<p>The <code>fattr()</code> function helps assign formatting attributes to a vector or data frame column. The <code>fattr()</code> function can assign the format, width, and justify attributes all at once. These attributes are passed in as arguments to the <code>fattr()</code> function, instead of as properties on a call to <code>attr()</code>.</p>
</div>
<div id="other-convenience-functions" class="section level3">
<h3>Other convenience functions</h3>
<p>The <code>logr</code> package contains several other functions for setting attributes easily. These include the <code>widths</code> and <code>justification</code> functions to set columns widths and column justification on an entire data frame. The package also includes class testing functions like <code>is.format</code> and <code>is.flist</code>.</p>
</div>
</div>
<div id="formatting-helper-functions" class="section level2">
<h2>Formatting Helper Functions</h2>
<p>The <strong>fmtr</strong> package also contains several formatting helper functions. These functions help with common formatting styles seen in statistical reports. For example, a range from 1 to 10 is commonly displayed as â1 - 10â, with a hyphen separating the minimum from the maximum. To accomplish this formatting easily, the package provides a <code>fmt_range()</code> function that both calculates the range and formats it in the desired manner.</p>
<p>Below is a complete list of the formatting helper functions. See the help documentation for additional details:</p>
<ul>
<li><code>fmt_range()</code></li>
<li><code>fmt_n()</code></li>
<li><code>fmt_quantile_range()</code></li>
<li><code>fmt_median()</code></li>
<li><code>fmt_cnt_pct()</code></li>
<li><code>fmt_mean_sd()</code></li>
</ul>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
